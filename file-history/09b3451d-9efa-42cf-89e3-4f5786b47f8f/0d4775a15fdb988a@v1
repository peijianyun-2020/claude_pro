---
name: xianhuoprice
description: 南方区域电力现货价格数据自动化采集工具。使用Chrome DevTools自动访问交易系统、提取日前和实时用电侧成交价格数据，并生成CSV文件。支持全自动采集流程，无需手动复制JSON数据。
---

# 南方区域电力现货价格自动化采集助手

## 概述

本 Skill 提供从南方区域现货电能量交易系统**自动化提取**用电侧成交价格数据的能力，包括：
1. **全自动数据采集** - 使用Chrome DevTools自动访问系统并提取数据
2. 日前价格数据提取 (dateType="0")
3. 实时价格数据提取 (dateType="1")
4. 数据格式转换 (API响应 → CSV)
5. 批量日期数据处理

适用场景：
- 日常电价数据采集
- 历史数据批量提取
- 价格趋势分析数据准备
- 市场交易数据归档

## 核心特性

✅ **全自动采集** - 无需手动复制JSON数据
✅ **智能导航** - 自动定位到用电侧成交价格模块
✅ **自动提取** - 自动捕获API响应数据
✅ **数据验证** - 自动检查数据完整性和有效性
✅ **格式转换** - 自动生成标准CSV文件
✅ **数据备份** - 自动保存API原始数据备份

## 快速开始

### 方式一：全自动采集（推荐）

当用户说："采集20260111的日前现货价格" 或 "提取2026-01-11的实时数据"

**执行步骤：**
1. 确认目标日期和数据类型（实时/日前）
2. Claude Code自动打开交易系统
3. **用户手动完成登录**（仅需一次）
4. Claude Code自动执行以下操作：
   - 导航到"用电侧成交价格"模块
   - 选择指定日期和数据类型
   - 提取API响应数据
   - 生成CSV文件
   - 验证数据完整性
5. 返回采集结果和文件路径

**优势：**
- 无需打开Chrome DevTools
- 无需手动查找API请求
- 无需复制粘贴JSON数据
- 全程自动化，省时省力

### 方式二：交互式采集

当用户说："我要采集现货价格" 或 "帮我提取电价数据"

**执行步骤：**
1. 询问目标日期和数据类型
2. 执行全自动采集流程
3. 返回采集结果

### 方式三：批量采集

当用户说："采集最近7天的日前数据" 或 "批量提取2025年12月的数据"

**执行步骤：**
1. 确定日期范围和数据类型
2. 为每个日期依次执行自动采集
3. 批量生成多个CSV文件
4. 汇总采集结果和统计信息

## 系统要求

### 必需组件
- **Chrome浏览器** - 用于访问交易系统
- **Chrome DevTools MCP服务** - Claude Code的浏览器自动化工具
- **网络连接** - 访问交易系统需要互联网

### MCP工具列表
本技能依赖以下Chrome DevTools MCP工具：
- `list_pages` - 列出浏览器页面
- `new_page` / `navigate_page` - 导航到URL
- `take_snapshot` - 获取页面内容
- `click` - 点击页面元素
- `fill` - 填写表单
- `list_network_requests` - 列出网络请求
- `get_network_request` - 获取请求详情（含响应数据）

## 交易系统信息

### 平台地址
```
https://spot.poweremarket.com/uptspot/sr/mp/portaladmin/index.html#/
```

### 核心API接口
```
POST https://spot.poweremarket.com/uptspot/ma/spot/spottrade/scptp/sr/mp/spottrade/baseinfo/TranOver/getWatchUserPriceData
```

### 请求参数
```json
{
  "operateDate": "2026-01-11",  // 目标日期 YYYY-MM-DD
  "dateType": "0"                // "0"=日前, "1"=实时
}
```

### API响应结构
```json
{
  "code": 0,
  "msg": "success",
  "data": [
    {
      "watchUserPriceId": "唯一ID",
      "exchange": "00",          // 地区代码
      "price0000": "371.7845",  // 00:00价格
      "price0100": "348.1993",  // 01:00价格
      ...
      "price2300": "450.1234"   // 23:00价格
    }
  ]
}
```

## 地区代码映射

| 代码 | 地区 |
|------|------|
| 00 | 全区域 |
| 02 | 广东 |
| 03 | 广西 |
| 04 | 云南 |
| 05 | 贵州 |
| 06 | 海南 |

## 自动化采集流程详解

### 标准采集流程

```mermaid
graph TD
    A[开始采集] --> B[打开交易系统]
    B --> C{是否需要登录?}
    C -->|是| D[提示用户手动登录]
    D --> E[等待用户确认已登录]
    C -->|否| F[检查当前页面]
    E --> F
    F --> G[查找用电侧成交价格标签]
    G --> H[点击标签进入模块]
    H --> I[选择数据类型:日前/实时]
    I --> J[设置目标日期]
    J --> K[等待API请求触发]
    K --> L[查找getWatchUserPriceData请求]
    L --> M[提取API响应数据]
    M --> N{data是否为空?}
    N -->|是| O[提示数据尚未生成]
    N -->|否| P[处理数据并生成CSV]
    P --> Q[保存API备份]
    Q --> R[验证数据完整性]
    R --> S[返回采集结果]
    O --> S
```

### 详细步骤说明

#### 步骤1: 访问交易系统
```
操作：使用Chrome DevTools导航到交易平台
URL: https://spot.poweremarket.com/uptspot/sr/mp/portaladmin/index.html#/
等待：页面加载完成
```

#### 步骤2: 检查登录状态
```
检查：页面是否显示登录表单
判断依据：查找"账号登录"、"证书登录"等文本
```

**如果需要登录：**
- 提示用户手动完成登录操作
- 等待用户回复"已登录"或类似确认
- 继续后续流程

**如果已登录：**
- 直接进入下一步

#### 步骤3: 导航到用电侧成交价格模块
```
操作：
1. 获取页面快照，查找"用电侧成交价格"标签
2. 点击该标签
3. 等待页面内容加载完成
```

#### 步骤4: 选择数据类型
```
操作：
1. 查找"日前"和"实时"单选框
2. 根据用户需求点击对应选项
3. 等待页面响应
```

#### 步骤5: 设置日期
```
操作：
1. 查找日期输入框（运行日）
2. 点击日期框打开日期选择器
3. 选择目标日期
4. 等待API请求触发
```

#### 步骤6: 提取API数据
```
操作：
1. 列出所有XHR/Fetch类型的网络请求
2. 查找URL包含"getWatchUserPriceData"的请求
3. 获取该请求的响应数据
4. 解析JSON响应
```

#### 步骤7: 处理数据
```
如果data不为空：
1. 验证数据完整性（6个地区，24个小时）
2. 生成CSV文件
3. 保存API备份（JSON格式）
4. 返回采集结果和文件路径

如果data为空：
1. 提示数据尚未生成
2. 说明可能的原因（日期、数据类型）
3. 建议其他操作
```

## 数据类型说明

### 日前数据 (Day-Ahead)
- **dateType**: "0"
- **用途**: 次日价格预测、交易计划制定
- **更新**: 每日发布未来24小时预测价格
- **发布时间**: 通常在运行日前一天深夜（接近0:00）
- **文件命名**: `日前价格_YYYYMMDD.csv`

### 实时数据 (Real-Time)
- **dateType**: "1"
- **用途**: 实时结算、实际用电成本分析
- **更新**: 实时更新（15分钟间隔）
- **数据特点**: 部分时段可能尚未发生
- **文件命名**: `实时价格_YYYYMMDD.csv`

## CSV输出格式

### 文件结构
```csv
时间,全区域,广东,广西,云南,贵州,海南
00:00,371.7845,387.849,373.3411,249.8317,438.4059,449.9766
01:00,348.1993,361.7443,331.3694,204.2519,425.8183,500.0455
...
23:00,450.1234,470.2341,445.3456,320.1234,520.3456,530.4567
```

### 数据行数
- 标题行：1行
- 数据行：24行（每个小时一行）
- 总计：25行

### 文件编码
- UTF-8 with BOM (utf-8-sig)
- 兼容Excel、Pandas、CSV阅读器

## 文件路径配置

### 工作目录
```
D:\AI\cc_pro\现货价格采集\
```

### CSV文件
```
实时价格_20260111.csv    # 实时数据
日前价格_20260111.csv    # 日前数据
```

### API备份文件
```
backups/
  api_backup_realtime_20260111.json
  api_backup_dayahead_20260111.json
```

## 使用示例

### 示例1: 采集单日日前价格

**用户请求：**
```
采集2026-01-11的日前价格
```

**Claude Code操作：**
1. 确认参数：日期=2026-01-11，类型=dayahead
2. 访问交易系统
3. 等待用户登录
4. 自动导航到用电侧成交价格模块
5. 选择"日前"和日期"2026-01-11"
6. 提取API数据
7. 生成`日前价格_20260111.csv`
8. 返回结果：
   ```
   ✅ 采集成功！
   📁 文件路径: D:\AI\cc_pro\现货价格采集\日前价格_20260111.csv
   📊 数据行数: 24行
   ✅ 数据完整性: 完美
   ```

### 示例2: 采集多日实时价格

**用户请求：**
```
采集最近3天的实时数据
```

**Claude Code操作：**
1. 确定日期范围：2026-01-08, 2026-01-09, 2026-01-10
2. 依次采集每一天：
   - 2026-01-08 → 实时价格_20260108.csv
   - 2026-01-09 → 实时价格_20260109.csv
   - 2026-01-10 → 实时价格_20260110.csv
3. 汇总结果：
   ```
   ✅ 批量采集完成！
   📁 采集文件: 3个
   ✅ 成功: 3个
   ❌ 失败: 0个
   ```

### 示例3: 数据未生成的处理

**用户请求：**
```
采集2026-01-12的日前价格
```

**采集结果：**
```
⚠️ 数据尚未生成

原因分析：
- API返回: {"code":0,"msg":"success","data":[]}
- data字段为空，表示2026-01-12的日前数据尚未发布

可能原因：
1. 日期过早（如明天），数据还未生成
2. 数据通常在运行日前一天深夜发布

建议：
1. 采集2026-01-11的日前价格
2. 或稍后重试2026-01-12的数据
```

## 常见问题处理

### Q1: Chrome DevTools MCP未连接？
**解决方案：**
- 确认Chrome DevTools MCP服务已安装并启动
- 检查MCP配置文件中的服务地址
- 重启Claude Code

### Q2: 找不到"用电侧成交价格"标签？
**解决方案：**
- 确认已登录系统
- 等待页面完全加载
- 刷新页面重新尝试
- 检查用户权限是否包含该模块

### Q3: API返回空数据？
**解决方案：**
- 检查日期是否过早（如未来日期）
- 确认数据类型选择正确（日前/实时）
- 验证该日期是否应该有数据
- 尝试采集其他日期

### Q4: 数据不完整（缺少某些地区）？
**解决方案：**
- 检查原始API响应是否包含该地区
- 验证6个地区代码是否都存在
- 可能是系统数据问题，联系系统管理员

### Q5: CSV文件乱码？
**解决方案：**
- 使用Excel打开时选择UTF-8编码
- 或用记事本/VSCode直接查看
- 脚本已使用utf-8-sig编码确保兼容性

## 数据验证检查清单

采集完成后自动验证：
- [x] CSV文件包含24行数据（不含标题）
- [x] 所有6个地区都有数据
- [x] 价格值合理（非负、非异常大）
- [x] 文件命名正确（日期、类型匹配）
- [x] 文件保存在正确目录
- [x] 数据可被Excel/Pandas正确读取

## 最佳实践

1. **采集时机**
   - 日前数据：建议在运行日当天采集
   - 实时数据：建议在运行日结束后采集

2. **批量采集**
   - 使用脚本自动化重复性工作
   - 避免在高峰时段（上午9-11点）采集

3. **数据备份**
   - 采集后系统自动保存API备份
   - 定期清理过期备份文件

4. **错误处理**
   - 采集失败时系统会记录详细错误信息
   - 根据错误提示调整采集策略

5. **数据验证**
   - 每次采集后自动检查数据完整性
   - 发现异常及时重新采集

## 技术架构

### 脚本组成
```
scripts/
├── auto_collect_spot_price.py    # 自动化采集主脚本
└── process_spot_price.py         # 数据处理工具脚本
```

### 功能模块
1. **自动化采集模块** (`auto_collect_spot_price.py`)
   - Chrome DevTools集成
   - 页面导航和交互
   - API数据提取

2. **数据处理模块** (`process_spot_price.py`)
   - JSON到CSV转换
   - 数据验证
   - 统计分析

## 更新日志

### v2.0 (2026-01-11)
- ✨ 新增：全自动采集功能
- ✨ 新增：Chrome DevTools集成
- ✨ 新增：智能导航和数据提取
- ✨ 新增：自动数据备份
- 📝 更新：文档结构和说明

### v1.0 (2025-01-03)
- 初始版本，支持日前/实时价格数据采集
- 需要手动复制JSON数据

## 技术支持

如遇到问题：
1. 查看Chrome DevTools MCP服务状态
2. 检查系统登录状态和网络连接
3. 验证日期格式和数据类型参数
4. 查看API备份数据确认原始响应
5. 联系系统管理员确认数据可用性
