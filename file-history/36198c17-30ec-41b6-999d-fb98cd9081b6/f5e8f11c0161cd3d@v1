# 飞书应用创建指南

本文档详细介绍如何创建飞书应用并配置多维表格访问权限。

## 目录

1. [创建飞书应用](#创建飞书应用)
2. [获取应用凭证](#获取应用凭证)
3. [申请权限](#申请权限)
4. [获取表格信息](#获取表格信息)
5. [发布应用](#发布应用)

## 创建飞书应用

### 步骤 1：访问飞书开放平台

1. 打开浏览器，访问：https://open.feishu.cn/app
2. 使用飞书账号登录（个人账号或企业账号均可）

### 步骤 2：创建应用

1. 点击右上角 **"创建企业自建应用"** 按钮
   - 个人账号也可以创建"企业自建应用"
   - 如果没有企业，可以创建一个"个人企业"

2. 填写应用信息：
   - **应用名称**：例如 "Claude Code 数据同步"
   - **应用描述**：例如 "用于将 Claude Code 获取的数据同步到飞书多维表格"
   - **应用图标**：可选，可以上传自定义图标或使用默认图标

3. 点击 **"创建"** 完成应用创建

## 获取应用凭证

### 步骤 1：进入应用详情

创建成功后，会自动跳转到应用详情页面。或者从应用列表中点击你的应用。

### 步骤 2：获取 App ID 和 App Secret

1. 在左侧菜单中，点击 **"凭证与基础信息"**
2. 在 **"凭证"** 部分，你可以看到：
   - **App ID**：格式类似 `cli_xxxxxxxxxxxxx`
   - **App Secret**：格式类似 `xxxxxxxxxxxxxxxxxxxx`

3. 点击 **"查看"** 按钮可以查看完整的 App Secret

⚠️ **重要提示**：
- 请妥善保管 App Secret，不要泄露给他人
- App Secret 等同于应用密码，泄露后他人可以你的名义操作飞书数据

## 申请权限

### 步骤 1：进入权限管理

1. 在左侧菜单中，点击 **"权限管理"**
2. 你会看到所有可申请的权限列表

### 步骤 2：申请多维表格权限

找到并申请以下权限：

1. **bitable:app** - 查看、评论和编辑多维表格
   - 这个权限允许应用读取和写入多维表格数据
   - 状态：需要开通

2. **bitable:app:readonly** - 只读访问多维表格（可选）
   - 如果只需要读取数据，可以只申请这个权限
   - 但为了写入数据，必须申请 `bitable:app`

3. 点击每个权限右侧的 **"申请权限"** 按钮
4. 选择 **"全部员工"** 或 **"仅本人"**（个人应用建议选"仅本人"）
5. 点击 **"确定"** 提交申请

### 步骤 3：等待审批

- **个人应用**：权限通常会自动审批通过
- **企业应用**：可能需要管理员审批

在权限管理页面可以看到每个权限的审批状态：
- ✅ **已开通** - 权限已激活
- ⏳ **审批中** - 等待管理员审批
- ❌ **已驳回** - 权限被拒绝

## 获取表格信息

### 步骤 1：打开多维表格

1. 在飞书中打开你想要写入数据的多维表格
2. 或创建一个新的多维表格

### 步骤 2：从 URL 中提取信息

表格 URL 格式：
```
https://feishu.cn/base/bascnxxxxxxxxxxxx?table=tblxxxxxxxxxxxx
```

从 URL 中提取：
- **app_token**：`basc` 开头的部分（`bascnxxxxxxxxxxxx`）
- **table_id**：`tbl` 开头的部分（`tblxxxxxxxxxxxx`）

如果 URL 中没有 `table=` 参数：
1. 点击表格中的具体数据表
2. URL 会自动更新，包含 `table=` 参数

### 步骤 3：配置字段（可选）

如果你的表格还没有字段，可以先创建字段。常见字段类型：

| 字段类型 | 说明 | 示例 |
|---------|------|------|
| 文本 | 短文本内容 | 标题、作者 |
| 长文本 | 长文本内容 | 正文、描述 |
| 数字 | 数值 | 点赞数、价格 |
| 日期 | 日期时间 | 发布时间 |
| URL | 链接 | 笔记链接 |
| 电话 | 电话号码 | 联系电话 |
| 邮箱 | 邮箱地址 | 联系邮箱 |
| 单选 | 单选选项 | 分类、状态 |
| 多选 | 多选选项 | 标签 |

## 发布应用

### 步骤 1：进入发布管理

1. 在左侧菜单中，点击 **"发布管理"**
2. 点击 **"创建版本"**

### 步骤 2：填写版本信息

1. **版本号**：例如 `1.0.0`
2. **更新日志**：描述这个版本的更新内容
3. 点击 **"创建"**

### 步骤 3：申请发布

1. 创建版本后，点击 **"申请发布"**
2. 选择 **"仅企业内使用"**（个人应用也选这个）
3. 点击 **"确定"**

### 步骤 4：等待审核

- **个人应用**：通常会自动通过审核
- **企业应用**：可能需要管理员审核

审核通过后，应用就可以正常使用了。

## 测试应用

### 方法 1：使用测试脚本

在项目目录中运行：

```bash
python server.py --check
```

如果配置正确，会显示：
```
✅ FEISHU_APP_ID: 已配置
✅ FEISHU_APP_SECRET: 已配置
✅ FEISHU_APP_TOKEN: 已配置
✅ FEISHU_TABLE_ID: 已配置
✅ 成功连接到飞书多维表格！
   字段数量: X
```

### 方法 2：在 Claude Code 中测试

配置好 MCP 服务器后，在 Claude Code 中输入：

```
获取飞书表格的字段结构
```

如果能成功返回字段信息，说明配置正确！

## 常见问题

### Q1：个人账号可以创建应用吗？

**A**：可以！个人账号也可以创建"企业自建应用"。如果没有企业，飞书会自动为你创建一个"个人企业"。

### Q2：权限申请被拒绝怎么办？

**A**：
- 确认你选择的权限类型正确（`bitable:app`）
- 检查是否是企业管理员拒绝了申请
- 联系飞书客服：https://open.feishu.cn/support

### Q3：如何查看 App Secret？

**A**：
1. 进入应用详情 → 凭证与基础信息
2. 点击 App Secret 右侧的 **"查看"** 按钮
3. 验证手机号或邮箱后即可查看

⚠️ **注意**：App Secret 只显示一次，请立即复制保存！

### Q4：应用可以访问其他人的表格吗？

**A**：不可以。应用只能访问：
- 应用创建者拥有权限的表格
- 明确授权给应用的表格

### Q5：表格 URL 中没有 table_id 怎么办？

**A**：
1. 点击表格中的具体数据表（工作表）
2. URL 会自动更新，包含 `table=` 参数
3. 从 URL 中提取 table_id

## 下一步

应用创建完成后，继续查看：
- [使用说明](./使用说明.md) - 配置和使用 MCP 服务器
- [故障排查](./故障排查.md) - 解决常见问题

## 需要帮助？

- 飞书开放平台文档：https://open.feishu.cn/document
- 飞书开发者社区：https://open.feishu.cn/community
