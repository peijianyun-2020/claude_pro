"""
é£ä¹¦çŸ¥è¯†åº“ä¸Šä¼ è„šæœ¬
"""
import os
from dotenv import load_dotenv
from feishu_uploader import FeishuWikiUploader
from pathlib import Path

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# è·å–é…ç½®
app_id = os.getenv("FEISHU_APP_ID")
app_secret = os.getenv("FEISHU_APP_SECRET")
wiki_space_id = os.getenv("FEISHU_WIKI_SPACE_ID")

# åˆ›å»ºä¸Šä¼ å™¨
print("=" * 60)
print("é£ä¹¦çŸ¥è¯†åº“æ–‡ä»¶ä¸Šä¼ ")
print("=" * 60)
print(f"\nğŸ“¡ æ­£åœ¨è¿æ¥é£ä¹¦...")
uploader = FeishuWikiUploader(app_id, app_secret, wiki_space_id)

# è·å–è®¿é—®ä»¤ç‰Œ
uploader.get_tenant_access_token()
print("âœ… è¿æ¥æˆåŠŸï¼")

# ä¸Šä¼ æ–‡ä»¶
file_path = r"D:\AI\cc_pro\program\20260113_File2feishu\æ•°æ®æ–‡æ¡£\20260113æ—¥å‰.xlsx"
print(f"\nğŸ“¤ æ­£åœ¨ä¸Šä¼ æ–‡ä»¶ï¼š{Path(file_path).name}")
print(f"   çŸ¥è¯†åº“ï¼š{wiki_space_id}")
print(f"   ä½ç½®ï¼šæ ¹ç›®å½•\n")

try:
    result = uploader.upload_file(file_path)
    print("âœ… ä¸Šä¼ æˆåŠŸï¼")
    print(f"\nç»“æœè¯¦æƒ…ï¼š")
    print(f"  èŠ‚ç‚¹ Token: {result.get('data', {}).get('node', {}).get('node_token')}")
    print(f"  èŠ‚ç‚¹æ ‡é¢˜: {result.get('data', {}).get('node', {}).get('title')}")
except Exception as e:
    print(f"âŒ ä¸Šä¼ å¤±è´¥ï¼š{str(e)}")
    import traceback
    traceback.print_exc()

print("\n" + "=" * 60)
print("æ‰“å¼€é£ä¹¦çŸ¥è¯†åº“æŸ¥çœ‹ä¸Šä¼ çš„æ–‡ä»¶å§ï¼")
print(f"https://my.feishu.cn/wiki/{wiki_space_id}")
print("=" * 60)
