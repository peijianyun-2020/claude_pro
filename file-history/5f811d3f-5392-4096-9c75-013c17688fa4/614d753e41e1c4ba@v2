# 广东电力现货价格预测系统设计方案

**日期**: 2026-01-12
**目标**: 建立日前和实时现货价格滚动预测系统，支持交易决策和风险管理
**区域**: 广东省电力市场

---

## 一、系统概述

### 1.1 业务目标
- **主要用途**: 交易决策支持和风险管理
- **预测目标**: 日前价格和实时价格，两个独立序列
- **预测范围**: 未来3天×24小时
- **更新频率**: 每日滚动预测，动态修正
- **性能指标**: 以MAPE（平均绝对百分比误差）为主要评估标准

### 1.2 数据现状
- **日前价格数据**: 历史数据位于 `基础数据/每日日前数据表/`，每日24个时点
- **实时价格数据**: 历史数据位于 `基础数据/每日实时数据表/`，每日24个时点，有2天延迟
- **预测信息披露**: 统调负荷、水电周预测、新能源总出力等，位于 `基础数据/预测信息披露/广东/`
- **时间跨度**: 2025年7月至今
- **待补充数据**: 气象数据（温度、辐照、降雨量、风速）

---

## 二、系统架构

### 2.1 分层架构设计

```
应用层: 滚动预测、结果输出、性能监控
         ↓
模型层: LSTM模型、XGBoost模型、集成融合模型
         ↓
特征工程层: 时间特征、滞后特征、统计特征、天气特征、市场特征
         ↓
采集层: 气象数据采集（和风天气API）、市场数据同步
         ↓
数据层: 原始数据、处理后数据、模型数据
```

### 2.2 项目结构

```
electricity_price_forecasting/
├── 基础数据/                    # 原始数据
│   ├── 每日日前数据表/          # 日前价格Excel文件
│   ├── 每日实时数据表/          # 实时价格Excel文件
│   ├── 预测信息披露/            # 市场预测信息
│   └── 气象数据/               # 气象数据（新增）
├── data/
│   ├── processed/              # 处理后的特征数据
│   └── predictions/            # 预测结果
├── models/                     # 保存的模型文件
├── src/
│   ├── data_collection/        # 数据采集模块
│   ├── preprocessing/          # 数据预处理和特征工程
│   ├── models/                 # 模型定义和训练
│   ├── prediction/             # 预测流程
│   └── evaluation/             # 评估和回测
├── notebooks/                  # Jupyter notebooks（开发和调试）
├── tests/                      # 单元测试
├── config/                     # 配置文件
├── docs/                       # 文档
├── main.py                     # 主程序入口
└── requirements.txt            # 依赖包列表
```

---

## 三、数据处理流程

### 3.1 数据导入

**日前价格数据**:
- 来源: `基础数据/每日日前数据表/` 目录下Excel文件
- 格式: 每个文件包含某日24个小时的价格
- 更新: D日可获取D-1日的日前价格数据

**实时价格数据**:
- 来源: `基础数据/每日实时数据表/` 目录下Excel文件
- 格式: 每个文件包含某日24个小时的价格
- 延迟: D日可获取D-2日的实时价格数据（2天延迟）

**预测信息披露**:
- 来源: `基础数据/预测信息披露/广东/`
- 内容: 统调负荷预测、水电周预测、新能源总出力预测
- 用途: 作为特征输入模型

**气象数据**:
- 来源: 和风天气API
- 内容: 温度、辐照度、降雨量、风速（按小时聚合）
- 区域: 广东省主要城市（广州、深圳、珠海、汕头、佛山等）

### 3.2 数据清洗与对齐

- 时间戳统一转换为标准格式
- 所有数据源对齐到**1小时粒度**（24个时点）
- 缺失值处理: 价格数据前向填充，天气数据插值法
- 异常值检测: 识别价格spikes（超过3倍标准差）
- 构建统一时间索引

### 3.3 特征构造

**时间特征**:
- 小时（0-23）、星期、月份、季度
- 是否工作日、是否节假日

**滞后特征**:
- 过去1天、3天、7天的同时刻（整点）价格均值和标准差
- 日前价格作为实时价格的滞后特征

**滚动统计特征**:
- 24小时、48小时、一周的滚动均值/最大值/最小值
- 价格波动率、移动平均相关系数

**天气特征**:
- 温度、辐照度、降雨量、风速及其一阶差分（变化率）
- 天气特征按小时聚合

**市场特征**:
- 统调负荷预测值
- 水电出力预测
- 新能源总出力

### 3.4 训练集构建

- 采用滑动窗口: 用过去30天的数据预测未来3天
- 按时间顺序划分训练集和验证集（避免未来信息泄露）
- 为日前价格和实时价格分别构造训练集

---

## 四、模型设计

### 4.1 双模型策略

系统建立**两套独立的预测模型**，分别预测日前价格和实时价格。

**日前价格预测模型组**:
- 目标: 预测未来3天×24小时的日前价格
- 输入特征: 历史日前价格 + 预测信息 + 天气数据
- 验证: D+1日可获得实际日前价格并验证

**实时价格预测模型组**:
- 目标: 预测未来3天×24小时的实时价格
- 输入特征: 历史实时价格 + 历史日前价格（作为特征） + 预测信息 + 天气数据
- 验证: D+2日可获得实际实时价格并验证

**两套模型的关系**:
1. 日前价格是实时价格的重要特征
2. 预测顺序: 先预测日前价格，再预测实时价格（串行关系）
3. 可以分析日前-实时价差的预测，用于价差交易策略

### 4.2 LSTM深度学习模型

**网络结构**:
- 3层LSTM，每层128个神经元
- Dropout率0.2防止过拟合
- 全连接层输出

**输入设计**:
- 过去30天×24小时的时间序列数据
- 包含价格和所有特征

**输出**:
- 未来3天×24小时的价格预测

**训练策略**:
- 优化器: Adam，学习率0.001
- 批量大小: 32
- 早停法防止过拟合
- 损失函数: MSE（均方误差）

**特点**: 擅长捕捉长期时间依赖和复杂非线性模式

### 4.3 XGBoost传统机器学习模型

**模型配置**:
- 100棵树
- 最大深度6
- 学习率0.05

**输入设计**:
- 将时间序列特征展平为结构化特征
- 滞后值、统计特征、时间特征等

**输出**:
- 单步或多步预测

**训练策略**:
- 时间序列交叉验证
- 确保不使用未来数据

**特点**: 训练快，可解释性强，通过feature importance识别关键因素

### 4.4 集成融合模型

**融合策略**:
- 加权平均或线性回归（Stacking）
- 在验证集上寻找最优权重组合

**优势**:
- 结合深度学习的模式识别能力
- 结合传统机器学习的稳定性

**输出**:
- 未来3天×24小时的预测价格
- 95%置信区间（基于历史预测误差计算）

---

## 五、气象数据采集

### 5.1 数据源选择

**推荐方案**: 和风天气API + 国家气象科学数据中心

**理由**:
- 免费版（每日1000次调用）足够使用
- 数据质量好，支持历史和预报数据
- 覆盖中国地区，本地化支持好
- 合法、稳定，有API文档

### 5.2 数据需求

**空间范围**:
- 广东省主要城市: 广州、深圳、珠海、汕头、佛山等
- 电力负荷中心区域
- 选择5-8个代表性城市

**时间范围**:
- 历史数据: 2025年7月至今
- 预报数据: 未来3-7天逐小时预报

**气象要素**:
- 温度（2m气温）
- 辐照度（短波辐射）
- 降雨量（降水量）
- 风速（10m风速）

**时间粒度**: 按小时聚合（与价格数据匹配）

### 5.3 采集方案

**API调用**:
- 历史天气API: 批量获取历史数据
- 预报API: 每天定时获取未来3-7天预报
- 实时API: 每小时更新（可选）

**容错机制**:
- API调用失败时重试3次
- 记录失败日志
- 多城市数据互相备份

**数据存储**:
- 原始气象数据: `基础数据/气象数据/` 目录
- 处理后数据: `data/processed/` 目录
- 增量更新策略

---

## 六、预测流程

### 6.1 每日预测任务调度

**触发时机**:
- 每天早上固定时间（如8:00）自动运行
- 确保获取到最新的日前价格（D-1日）和气象预报

**任务流程**:
1. 检查并导入最新数据
   - 日前价格（D-1日）
   - 实时价格（D-2日）
   - 预测信息
   - 天气数据
2. 数据清洗和特征构造
3. 加载已训练的模型
4. 执行预测:
   - 先预测日前价格（D+1到D+3日）
   - 再预测实时价格（D+1到D+3日）
5. 保存预测结果（CSV文件）
6. 计算MAPE（如果有实际价格）
7. 生成预测报告（可选可视化）

### 6.2 滚动预测机制

- 每天重新预测未来3天，不断修正预测结果
- 保存每天的预测版本，便于追踪预测准确度
- 对于D日预测，使用D-1日的日前价格和D-2日的实时价格

### 6.3 预测输出

**主要输出**:
- 未来3天×24小时的日前价格预测值
- 未来3天×24小时的实时价格预测值
- 保存为CSV文件，格式: `data/predictions/YYYYMMDD_predictions.csv`

**置信区间**:
- 基于历史预测误差分布
- 计算95%置信区间

**可视化图表**:
- 价格曲线图（预测值 vs 历史实际值）
- 分日前和实时价格展示

**性能指标**:
- 每日MAPE
- 峰值时段误差
- 预测历史记录

### 6.4 异常处理

- 数据缺失: 使用最近可用数据并记录警告
- 预测结果异常: 标记并人工复核
- API失败: 重试机制和降级方案

---

## 七、模型动态更新策略

### 7.1 三层更新机制

**第一层: 在线预测（每天）**
- **目的**: 使用现有模型生成最新预测，不修改模型参数
- **操作**: 加载模型 → 推理 → 保存预测
- **成本**: 低（只需推理）

**第二层: 增量学习（每周）**
- **目的**: 让模型学习最近一周的新数据
- **触发条件**: 每累积7天新数据（或5个工作日）
- **操作**:
  - 合并新数据到历史数据集
  - 重新划分训练集和验证集
  - LSTM: 在新数据上fine-tune（学习率0.0001）
  - XGBoost: 使用全部数据重新训练
  - 评估新模型MAPE，如果降低则替换模型
- **成本**: 中

**第三层: 完全重构（每月）**
- **目的**: 全面评估和优化
- **触发条件**: 每月1号或累积30天新数据
- **操作**:
  - 分析过去30天MAPE趋势
  - 测试新特征
  - 超参数调优
  - 模型结构优化
  - A/B测试新旧模型
- **成本**: 高

### 7.2 模型版本管理

- 保存模型文件: `models/lstm_vYYYYMMDD.pkl`
- 记录元数据: 训练时间范围、验证集MAPE、超参数
- 保留最近3-5个版本，便于回滚

### 7.3 自动化监控指标

**每日计算**:
- MAPE趋势（7天/30天移动平均）
- 方向准确率
- 峰值误差
- 异常天数（MAPE超过15%）

**触发告警**:
- 连续3天MAPE高于历史平均1.2倍
- 某天预测误差超过25%
- MAPE持续上升

### 7.4 防止过拟合

- 时间序列交叉验证（不使用未来数据）
- 始终保留最近7-14天作为验证集
- LSTM早期停止
- XGBoost限制树深度

### 7.5 特殊情况处理

- **市场突变**: 手动触发模型重构
- **季节切换**: 考虑分季节建模
- **数据异常**: 该天不参与训练但记录日志

---

## 八、模型评估与回测

### 8.1 评估指标体系

**主要指标**:
- **MAPE**: 平均绝对百分比误差（最重要的指标）
- **MAE**: 平均绝对误差（元/MWh）
- **RMSE**: 均方根误差

**辅助指标**:
- 方向准确率: 预测涨跌方向的准确度
- 峰值时段误差: 高峰时段的预测误差
- 日内误差分布: 24小时的误差分布
- 日前-实时价差预测误差

### 8.2 回测方法

**时间序列交叉验证**:
- 不使用随机K-Fold
- 采用滚动窗口验证
- 例如: 用7月数据训练预测8月1-3日，用7月+8月1-3日训练预测8月4-6日

**Walk-Forward验证**:
- 模拟真实使用场景
- 初始用前30天训练，预测未来3天
- 加入新数据重新训练，再预测接下来3天

### 8.3 回测报告

- 每日MAPE曲线图
- 预测值vs实际值对比图（分日前和实时）
- 24小时误差分布热力图
- 典型好/坏预测案例分析

### 8.4 基准对比

与简单基准模型对比:
- 昨天价格预测
- 上周同日价格预测
- 确保复杂模型优于简单基准

---

## 九、技术栈

### 9.1 编程语言
- **Python 3.9+**

### 9.2 核心库

**数据处理**:
- pandas: 数据处理和分析
- numpy: 数值计算
- openpyxl: 读取Excel文件
- scikit-learn: 预处理、特征工程、交叉验证

**机器学习**:
- xgboost: XGBoost模型
- lightgbm: 备选梯度提升库

**深度学习**:
- PyTorch: LSTM模型（推荐）

**数据采集**:
- requests: 调用和风天气API
- BeautifulSoup4: 网页爬虫（备用）

**可视化**:
- matplotlib: 基础绘图
- seaborn: 统计图表
- plotly: 交互式图表（可选）

**调度与自动化**:
- APScheduler: Python定时任务
- 或系统级调度: Windows任务计划程序/cron

**存储**:
- CSV: 主要数据存储格式
- pickle/joblib: 模型文件
- SQLite: 预测历史和性能指标（可选）

### 9.3 开发环境
- **Jupyter Notebook**: 数据探索、模型开发
- **Python脚本**: 生产环境运行
- **Git**: 版本控制

---

## 十、实施计划

### 阶段一: 基础设施搭建（第1-2周）

**任务**:
1. 创建项目目录结构
2. 实现数据导入模块（读取Excel文件）
3. 实现数据预处理和特征工程模块
4. 数据探索性分析（EDA）
5. 建立baseline模型（简单方法）

**交付物**:
- 可运行的数据导入和预处理流程
- 数据质量报告
- 基准性能指标

---

### 阶段二: 天气数据集成（第2-3周）

**任务**:
1. 注册和风天气API
2. 实现天气数据采集模块
3. 批量下载历史天气数据
4. 合并天气数据与价格数据
5. 分析天气特征相关性
6. 更新特征工程模块

**交付物**:
- 完整的气象数据集
- 自动化采集脚本
- 天气特征重要性分析

---

### 阶段三: 模型开发（第3-5周）

**第3周 - XGBoost**:
1. 实现XGBoost日前价格预测模型
2. 实现XGBoost实时价格预测模型
3. 时间序列交叉验证
4. 特征重要性分析

**第4周 - LSTM**:
1. 实现LSTM日前价格预测模型
2. 实现LSTM实时价格预测模型
3. 超参数调优
4. 与XGBoost对比分析

**第5周 - 融合与评估**:
1. 实现模型融合
2. 完整回测评估
3. 生成预测报告和可视化

**交付物**:
- 4个训练好的模型（LSTM×2 + XGBoost×2）
- 1个融合模型
- 回测评估报告

---

### 阶段四: 自动化与部署（第5-6周）

**任务**:
1. 实现每日自动预测流程
2. 实现模型动态更新机制
3. 建立预测历史数据库
4. 开发性能监控仪表盘（可选）
5. 编写使用文档

**交付物**:
- 自动化预测系统
- 使用手册

---

### 阶段五: 迭代优化（持续）

**任务**:
1. 每周回顾预测准确度
2. 测试新特征
3. 尝试模型改进
4. 根据市场变化调整策略

---

## 十一、风险与应对

| 风险 | 应对措施 |
|------|---------|
| 数据量不足（只有几个月） | 使用迁移学习；先从简单模型开始 |
| 市场环境变化快 | 滚动预测和定期重训练 |
| 天气API不稳定 | 重试机制；考虑多数据源备份 |
| 过拟合 | 严格的时间序列交叉验证；正则化 |
| 实时价格2天延迟 | 在验证和训练时注意时间对齐 |

---

## 十二、总结

本设计方案建立了完整的广东电力现货价格预测系统，核心特点:

1. **双序列预测**: 分别预测日前价格和实时价格
2. **双模型融合**: LSTM + XGBoost + 集成融合
3. **滚动预测**: 每天更新未来3天预测
4. **动态更新**: 三层更新机制（每天/每周/每月）
5. **数据驱动**: 整合历史价格、预测信息、气象数据

系统以MAPE为主要优化目标，兼顾预测精度和模型稳定性，支持交易决策和风险管理。

---

**文档版本**: 1.0
**最后更新**: 2026-01-12
