# 小红书发布脚本说明

## publish_xiaohongshu.py

### 功能描述
自动发布电价分析内容到小红书,集成内容提取、登录检查和发布功能。

### 环境要求
- Python 3.10+
- 小红书MCP服务(通过Claude Code提供)
- 已完成小红书登录认证

### MCP工具依赖

本脚本依赖以下MCP工具(由Claude自动调用):

1. **mcp__xiaohongshu-mcp__check_login_status** - 检查登录状态
2. **mcp__xiaohongshu-mcp__get_login_qrcode** - 获取登录二维码
3. **mcp__xiaohongshu-mcp__publish_content** - 发布图文内容
4. **mcp__xiaohongshu-mcp__publish_with_video** - 发布视频内容(可选)

### 使用方法

#### 1. 发布指定日期内容
```bash
python publish_xiaohongshu.py --date 20251231 --category dayahead
```

#### 2. 发布今天的内容
```bash
python publish_xiaohongshu.py --date today --category dayahead
```

#### 3. 交互式选择
```bash
python publish_xiaohongshu.py --interactive
```
列出所有可发布内容,供用户选择。

#### 4. 检查登录状态
```bash
python publish_xiaohongshu.py --check-login
```

### 发布流程

1. **内容提取**
   - 从 `YYYYMMDD日前/文案_日前_YYYYMMDD.txt` 提取标题和正文
   - 定位图片文件(优先JPG,备选PNG)
   - 自动添加引导语"觉得有用请点赞收藏~"

2. **登录检查**
   - 调用 `check_login_status` MCP工具
   - 如未登录,提示用户扫码登录

3. **内容发布**
   - 调用 `publish_content` MCP工具
   - 传递参数:
     - `title`: 标题(限制20字)
     - `content`: 正文内容
     - `images`: 图片路径列表
     - `tags`: 标签列表

### 标签策略

**默认标签:**
```
["电力现货", "电价分析", "能源市场", "日前电价", "电力交易"]
```

**动态标签:**
- 包含"负价"或"0价" → 添加"价格波动"
- 市场情绪"偏强" → 添加"电价上涨"
- 市场情绪"偏弱" → 添加"电价下跌"

### 内容要求

#### 标题
- 最多20个中文字符
- 格式: `南方电力现货｜MM/DD 日前电价速报 ⚡️`

#### 正文
- 数据准确,来源明确
- 避免敏感词汇
- 包含关键分析结论

#### 图片
- 格式:JPG或PNG
- 大小:<10MB
- 清晰可读,建议宽度≥1080px

### 发布时机建议

| 时段 | 推荐度 | 说明 |
|------|--------|------|
| 09:00-11:00 | ⭐⭐⭐⭐⭐ | 工作日上午,用户活跃 |
| 14:00-16:00 | ⭐⭐⭐⭐ | 工作日下午 |
| 18:00-20:00 | ⭐⭐⭐ | 下班高峰期 |
| 23:00-07:00 | ⭐ | 避免深夜发布 |
| 周末全天 | ⭐⭐⭐ | 周末流量相对较少 |

### 频率控制
- 每日不超过2篇
- 同一内容不重复发布
- 建议固定时段发布,培养用户习惯

### 错误处理

| 错误 | 原因 | 解决方案 |
|------|------|----------|
| 登录失效 | Session过期 | 重新扫码登录 |
| 图片上传失败 | 格式或大小不符 | 检查图片,转JPG格式 |
| 内容审核失败 | 包含敏感词 | 修改文案,避免敏感词汇 |
| 文件夹不存在 | 未生成内容 | 先运行 `process_data.py` |
| MCP调用失败 | 服务异常 | 检查MCP服务状态 |

### 最佳实践

1. **发布前检查**
   - 审阅文案准确性
   - 确认图表清晰度
   - 验证数据日期

2. **发布后跟进**
   - 及时回复评论
   - 查看阅读/点赞/收藏数据
   - 记录高赞内容特征

3. **内容优化**
   - 分析数据趋势,优化发布时间
   - 根据用户反馈调整标签策略
   - 定期更新内容模板

4. **账号维护**
   - 保持每日或隔日发布频率
   - 避免长时间断更
   - 与同领域账号互动

### 示例输出

```
============================================================
小红书发布: 日前 20251231
============================================================

📖 步骤 1/3: 提取文案和图片...
✅ 标题: 南方电力现货｜12/31 日前电价速报 ⚡️
✅ 正文长度: 512 字符
✅ 图片: D:\AI\Trae项目工作区\...\20251231日前\图_日前_20251231.jpg
✅ 标签: 电力现货, 电价分析, 能源市场, 日前电价, 电力交易

🔍 步骤 2/3: 检查登录状态...
✅ 已登录

🚀 步骤 3/3: 发布到小红书...
✅ 发布成功!

============================================================
✅ 发布完成!
============================================================
```
